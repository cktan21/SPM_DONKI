_format_version: "3.0"
_transform: true

services:
  # - name: rabbitmq-management
  #   url: http://rabbitmq:15672
  #   routes:
  #     - name: rabbitmq-management-route
  #       paths:
  #         - /rabbitmq

  # Atomic Microservices
  - name: project-service
    url: http://project:5200
    routes:
      - name: project-route
        paths:
          - /project

  - name: tasks-service
    url: http://tasks:5500
    routes:
      - name: tasks-route
        paths:
          - /tasks

  - name: schedule-service
    url: http://schedule:5300
    routes:
      - name: schedule-route
        paths:
          - /schedule

  - name: user-service
    url: http://user:5100
    routes:
      - name: user-route
        paths:
          - /user
  
  # Composite Microservices
  - name: manage-task-service
    url: http://manage-task:4000
    routes:
      - name: manage-task-route
        paths:
          - /manage-task
  
  - name: manage-project-service
    url: http://manage-project:4100
    routes:
      - name: manage-project-route
        paths:
          - /manage-project

  - name: kafka-ui-service
    url: http://kafka-ui:8080
    routes:
      - name: kafka-ui-route
        paths:
          - /kafka-ui


plugins:
  - name: rate-limiting
    config:
      minute: 100
      policy: local

  - name: cors
    config:
      origins:
        - "http://localhost:3000"
        - "http://127.0.0.1:3000"
      methods:
        - HEAD
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Authorization          # Uncommented to allow auth headers
        - Access-Control-Allow-Origin
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
      credentials: true         # Added this line to allow credentials


  # - name: prometheus
  #   enabled: true
  #   protocols:
  #     - grpc
  #     - grpcs
  #     - http
  #     - https
  #   config:
  #     ai_metrics: false
  #     bandwidth_metrics: false
  #     latency_metrics: false
  #     per_consumer: false
  #     status_code_metrics: false
  #     upstream_health_metrics: false